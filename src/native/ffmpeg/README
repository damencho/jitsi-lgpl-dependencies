Notes 2017-10-07
================
Versions used:
- FFmpeg 3.3.4
- lame 3.99.5
- openh264 1.7.0.

0. Windows Preparations
-----------------------
- Get MSYS2 64bit distro
- Update it according to instructions
- Install packages:
  - make
  - diffutils
  - yasm
  - mingw-w64-x86_64-gcc
  - pkg-config
  - git
  - nasm

Copy <msys2-installir>/mingw64/bin/x86_64-w64-mingw32-gcc-ar.exe to
<msys2-installir>/mingw64/bin/x86_64-w64-mingw32-ar.exe

1. lame
-------

./configure \
    --disable-shared --enable-static \
    --enable-nasm \
    --disable-analyzer-hooks --disable-decoder --disable-frontend \
    --with-pic

FFmpeg looks for lame.h as lame/lame.h but the installed lame-3.99.5 does not
have the lame directory so go into lame-3.99.5/include and "ln -s . lame" on
Linux and Mac OS X or "mklink /d lame ." on Windows.

2. openh264
-----------

- Windows
make ARCH=x86_64 PREFIX=/mingw64 install

- Linux, Mac OS X
Install http://www.nasm.us/pub/nasm/releasebuilds/2.11.06/macosx/nasm-2.11.06-macosx.zip
brew install pkg-config
make install
cd openh264-1.7.0/codec/api
ln -s svc wels
export PKG_CONFIG_PATH=$OH264

3. ffmpeg
---------
export MP3LAME_HOME=/c/Java/lame-3.99.5
export OH264=/c/Java/openh264
./configure \
 --enable-version3 \
 --disable-programs \
 --disable-doc \
 --disable-network \
 --disable-everything \
 --enable-libmp3lame --enable-encoder=libmp3lame \
 --enable-parser=h264 \
 --enable-libopenh264 --enable-encoder=libopenh264 --enable-decoder=libopenh264 \
 --enable-decoder=mjpeg --enable-parser=mjpeg \
 --enable-filter=hflip --enable-filter=scale --enable-filter=nullsink \
 --extra-cflags="-I$MP3LAME_HOME/include -I$OH264/codec/api" \
 --extra-ldflags="-L$MP3LAME_HOME/libmp3lame -L$MP3LAME_HOME/libmp3lame/.libs -L$OH264" \
 

- Windows

x86:
Add the following to the configure line:
--target-os=mingw32 --enable-memalign-hack --disable-pthreads --enable-w32threads

x64:
Add the following to the configure line used for x86:
--arch=x86_64 --target-os=mingw32 --enable-cross-compile

- FreeBSD, Linux

Add the following to the configure line:
--enable-pic --enable-pthreads --enable-decoder=mjpeg --enable-parser=mjpeg

- Mac OS X


5. jnffmpeg
export FFMPEG_HOME=/Users/dminkov/dev/ffmpeg/FFmpeg-n2.8.11
export MP3LAME_HOME=/Users/dminkov/dev/ffmpeg/lame-3.99.5
export OH264=/Users/dminkov/dev/ffmpeg/openh264-1.5.0
ant ffmpeg -Dffmpeg=$FFMPEG_HOME -Dlame=$MP3LAME_HOME -Dopenh264=$OH264

Define the environment variable JAVA_HOME so that the JNI headers can be found.
Change the current directory to libjitsi/ and run "ant ffmpeg" passing it values
for the ffmpeg, lame, and open264 properties which specify the paths to
the homes of the development trees of the respective libraries.

For creating universal libraries for Mac OS X see the instructions in src/native/build.xml.